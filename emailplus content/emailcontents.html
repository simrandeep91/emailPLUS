<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html class=" regenabled  gecko radius jsenabled regloaded" lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<script type="text/JavaScript" src="emailcontents_files/cookie_get.js"></script>
<title>jGuru: Fundamentals of the JavaMail API</title>
<meta http-equiv="content-language" content="en">
<meta name="collection" content="learning">
<meta name="keywords" content="JavaMail, jGuru, learn, mail, tutorial">
<meta name="description" content="The course outline for the fundamentals of the JavaMail API">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="revision" content="@(#)index2.src....1.2 06/09/99  JDC">
<meta name="archive" content="false">
<meta name="archive" content="FALSE">
<meta name="date" content="2005-11-03">
<link rel="stylesheet" href="emailcontents_files/default_developer.css">
<script language="JavaScript" type="text/javascript" src="emailcontents_files/popUp.js"></script>
<script language="javascript1.2" type="text/javascript" src="emailcontents_files/sniff.js"></script>
<script language="javascript1.2" type="text/javascript" src="emailcontents_files/menucontent.js"></script>
<script language="javascript1.2" type="text/javascript" src="emailcontents_files/menucode.js"></script>
<script language="javascript1.2" type="text/javascript" src="emailcontents_files/developer.js"></script>
</head>
<!--stopindex-->
<body leftmargin="0" topmargin="0" rightmargin="0" onload="prepmenus(); done=true" bgcolor="#ffffff" marginheight="0" marginwidth="0">
<a name="top"></a>
<!-- THIS FILE IS GENERATED BY A DCR FILE -->
<!-- BEGIN GENERIC MASTHEAD -->
<!-- BEGIN A1 COMPONENT V.0 -->
<div class="a1 a1r2">
<div class="a1v0">
<a href="#skip2content" class="skiplink">Skip to Content</a>
<span class="toolbarlinks">
<a class=" karrow k2over a1menu1 y3 x-6" href="http://java.sun.com/global/mh/suncom/index.html">Sun</a><div id="a1menu1" class="a1menu a1Large"><div class="a1menux1"></div>
<div class="a1menuw2"><div class="a1menuw1">
<div class="a1-2colwrap"><div class="a1-2colul"><ul class="bluearrows"><li><a href="http://www.sun.com/">Sun.com</a></li><li><a href="http://www.sun.com/aboutsun/">About Sun</a></li><li><a href="http://www.sun.com/download/">Downloads</a></li><li><a href="http://www.sun.com/products/">Products</a></li></ul><ul class="bluearrows"><li><a href="http://www.sun.com/servicessolutions/">Solutions</a></li><li><a href="http://sunsolve.sun.com/pub-cgi/show.pl?target=tous">Support</a></li><li><a href="http://www.sun.com/training/">Training</a><p></p></li></ul></div></div><br class="clear"></div><div class="a1menux2"></div></div></div>
<a class=" karrow k2over a1menu2 y3 x-6" href="http://java.sun.com/global/mh/java/">Java</a><div id="a1menu2" class="a1menu a1Large"><div class="a1menux1"></div>
<div class="a1menuw2"><div class="a1menuw1">
<div class="a1-2colwrap"><div class="a1-2colul"><ul class="bluearrows"><li><a href="http://java.com/download/">Java for your computer</a><p>Stay up to date with the latest versions of Java for your desktop computer.</p></li><li><a href="http://www.sun.com/software/opensource/java/">Free and Open Source Java</a><p>Get your own copy of the underlying software code for the Java language.</p></li><li><a href="http://java.sun.com/javase/downloads/">Download the latest JDK</a><p>The basic developer kit for Java developers.</p></li><li><a href="http://java.sun.com/javaee/downloads/">Download the Java EE SDK</a><p>The SDK supports Java SE 6 and the latest Java EE 5 technologies.</p></li><li><a href="http://www.netbeans.org/downloads/index.html">Download NetBeans IDE</a><p>Get the award-winning, open-source tool suite for developing Java applications.</p></li><li><a href="http://java.sun.com/">Java Developer Resources</a><p>Visit java.sun.com for everything you need to know about the Java technology.</p></li></ul><ul class="bluearrows"><li><a href="http://developers.sun.com/prodtech/javatools/">Java Developer Tools</a><p>See and download all software tools available from Sun.</p></li><li><a href="http://java.sun.com/javase/">Java Standard Edition</a><p>For developing and deploying Java applications for the desktop, servers, embedded, and real-time environments.</p></li><li><a href="http://java.sun.com/javaee/">Java Enterprise Edition</a><p>For enterprise, server-side Java applications.</p></li><li><a href="http://java.sun.com/javame/">Java Micro Edition</a><p>For Java applications running on mobile devices.</p></li><li><a href="http://java.sun.com/learning/training/">Java Training</a><p>Sharpen your Java skills with courses from the source.</p></li><li><a href="http://developers.sun.com/services/">Java Support</a><p>Get dedicated help from Sun including technical assistance, product support, and support for deployed Java applications.</p></li></ul></div></div><br class="clear"></div><div class="a1menux2"></div></div></div>
<a class=" karrow k2over a1menu3 y3 x-6" href="http://java.sun.com/global/mh/solaris/">Solaris</a><div id="a1menu3" class="a1menu a1Medium"><div class="a1menux1"></div>
<div class="a1menuw2"><div class="a1menuw1">
<ul class="bluearrows"><li><a href="http://www.opensolaris.com/get/">OpenSolaris</a><p>Download, develop and collaborate with OpenSolaris</p></li><li><a href="http://www.sun.com/software/solaris/get.jsp">Solaris</a><p>Download the most advanced operating system in the world</p></li><li><a href="http://developers.sun.com/sunstudio/">Sun Studio</a><p>Optimizing compilers and tools for C/C++/Fortran application development</p></li><li><a href="http://developers.sun.com/solaris/">Solaris Developer Center</a><p>Explore the resources and community available to the Solaris developer.</p></li><li><a href="http://developers.sun.com/services/">Sun Developer Services</a><p>Get technical assistance, product support, training, and other services from the source.</p></li><li><a href="http://www.sun.com/bigadmin/home/index.html">BigAdmin</a><p>A
 community site with Solaris system administration information, hardware
 compatibility, a script library, and other resources for administrators
 of Sun products.</p></li></ul></div><div class="a1menux2"></div></div></div>
<a href="http://java.sun.com/global/mh/communities/" class="dividelink">Communities</a>
<a class=" karrow k2over a1menu5 y3 x-6" href="http://developers.sun.com/global/my_profile.html">My SDN Account</a><div id="a1menu5" class="a1menu a1Small"><div class="a1menux1"></div>
<div class="a1menuw2"><div class="a1menuw1">
<ul class="bluearrows"><li><a href="https://reg.sun.com/updateaccount?program=sdn&amp;goto=http://developers.sun.com">Update My Profile</a></li></ul></div><div class="a1menux2"></div></div></div>

</span>
</div>
</div>
<!-- END A1 COMPONENT V.0 -->
<!-- BEGIN A2 COMPONENT V.1 -->
<div class="a2w0">
<div class="a2" id="a2v1">
<div class="a2w1"><div class="a2w2"><div class="a2w3"><div class="a2w4">
<div class="a2topiclinks">
<div class="a2search">
<form action="http://search.sun.com/main/index.jsp" accept-charset="utf-8" method="GET">
<input name="charset" value="utf-8" type="hidden">
<input name="col" value="main-developer-all" type="hidden">
<span class="rightarrowwhite">»</span>&nbsp;<a href="http://developers.sun.com/global/search_tips.html">search tips</a>&nbsp;
<input class="searchfield" name="qt" size="7" onfocus="if( this.value==this.defaultValue ) this.value='';" value="Search">
<input id="searchbttn" src="emailcontents_files/a2_bttn_search.gif" alt="Submit Search" border="0" type="image">
</form>
</div>
<a href="http://www.sun.com/" title="Sun Microsystems Home Page" id="sunlogo"><img src="emailcontents_files/a_002.gif" alt="Home Page" border="0" height="58" width="98"></a>
<a href="http://developers.sun.com/" title="Sun Developer Network"><img src="emailcontents_files/a_002.gif" id="venuespacer" alt="Sun Developer Network" border="0" height="33" width="400"></a>
<ul id="mtopics">
<li id="mtopic1"><a id="glink1" class="tpclink a2menu" title="See All APIs" href="http://java.sun.com/global/mh/api/index.html">APIs</a></li>
<li id="mtopic2"><a id="glink2" class="tpclink a2menu" title="See All Downloads" href="http://java.sun.com/global/mh/downloads/index.html">Downloads</a></li>
<li id="mtopic3"><a id="glink3" class="tpclink a2menu" title="See All Products" href="http://java.sun.com/global/mh/products/index.html">Products</a></li>
<li id="mtopic4"><a id="glink4" class="tpclink a2menu" title="See All Support" href="http://java.sun.com/global/mh/support/index.html">Support</a></li>
<li id="mtopic5"><a id="glink5" class="tpclink a2menu" title="See All Training" href="http://java.sun.com/global/mh/training/index.html">Training</a></li>
<li id="mtopic6"><a id="glink6" class="tpclink a2menu" title="See All Participate" href="http://java.sun.com/global/mh/participate/index.html">Participate</a></li>
</ul>
</div>
</div></div></div></div>
</div></div>
<!-- END A2 COMPONENT V.1 -->
<!-- END GENERIC MASTHEAD -->
<!-- BEGIN BREADCRUMB -->
<div id="breadcrumb">
<a href="http://developers.sun.com/index.jsp">SDN Home</a> &gt; <a href="http://java.sun.com/index.jsp">Java Technology</a> &gt; <a href="http://java.sun.com/learning/index.html">Learning</a> &gt; <a href="http://java.sun.com/learning/online/index.html">Online Courses</a> &gt; <a href="http://java.sun.com/developer/onlineTraining/index.html">Tutorials and Online Training</a> &gt; 
</div><br>
<!-- END BREADCRUMB -->
<!-- BEGIN PAGETITLE -->
<div class="pagetitle2">Tutorials</div>
<div id="sharepage" class="smallpagetitle"><h1>jGuru: Fundamentals of the JavaMail API</h1><div class="sharepage">		<div class="sharepagew1 share-mailto">		<table summary="layout" cellpadding="0" cellspacing="0"><tbody><tr>		<td id="share-mailto"><a href="mailto:?subject=Sun%20Web%20Page:%20jGuru:%20Fundamentals%20of%20the%20JavaMail%20API&amp;body=Check%20out%20this%20page%20on%20sun.com:%20%0A%0Ahttp%3A%2F%2Fjava.sun.com%2Fdeveloper%2FonlineTraining%2FJavaMail%2Fcontents.html" class="sharelink mailto" title="Email this page to a friend"></a></td>		<td id="share-technorati"><a href="http://technorati.com/search/http%3A%2F%2Fjava.sun.com%2Fdeveloper%2FonlineTraining%2FJavaMail%2Fcontents.html" class="sharelink technorati" title="See who links to this page on Technorati"></a></td>		<td id="share-delicious"><a href="http://del.icio.us/post?v=4;url=http%3A%2F%2Fjava.sun.com%2Fdeveloper%2FonlineTraining%2FJavaMail%2Fcontents.html;title=jGuru%3A%20Fundamentals%20of%20the%20JavaMail%20API" class="sharelink delicious" title="Bookmark this page in del.icio.us"></a></td>		<td id="share-digg"><a href="http://digg.com/submit?phase=2&amp;url=http%3A%2F%2Fjava.sun.com%2Fdeveloper%2FonlineTraining%2FJavaMail%2Fcontents.html&amp;title=jGuru%3A%20Fundamentals%20of%20the%20JavaMail%20API" class="sharelink digg" title="Submit this page to Digg"></a></td>		<td id="share-slashdot"><a href="http://slashdot.org/bookmark.pl?title=jGuru%3A%20Fundamentals%20of%20the%20JavaMail%20API&amp;url=http%3A%2F%2Fjava.sun.com%2Fdeveloper%2FonlineTraining%2FJavaMail%2Fcontents.html" class="sharelink slashdot" title="Submit this page to Slashdot"></a></td>		<td id="share-blank"> </td></tr></tbody></table></div></div></div>
<!-- END PAGETITLE -->
<!-- BEGIN WRAPPER TABLE, 2 COLUMN, MAIN/RIGHT -->
<table border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td valign="top" width="100%">
<!-- BEGIN CENTRAL COLUMN COMPONENTS -->
<!--startindex-->
<!-- ============ -->
<!-- MAIN CONTENT -->
<!-- ============ -->
<a name="skip2content"></a>
<!--  BEGIN VCD4 PFV  -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="smaller" valign="top"><em></em></td>
<td width="10">&nbsp;</td>
<td align="right" valign="bottom"><div class="sitelinks" style="padding:0px;">
<table border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td align="right" valign="bottom">&nbsp;</td>
<td class="smaller" nowrap="nowrap" valign="bottom"><a href="http://java.sun.com/jsp_utils/PrintPage.jsp" target="printFriendlyView" onclick="openPopup('','printFriendlyView',710,650,'no',1,1,0,0,0,0); return true;"><img src="emailcontents_files/ic_print.gif" alt="Print-friendly Version" border="0" height="12" hspace="4" width="14">Print-friendly Version</a><br></td>
</tr></tbody></table></div>
</td></tr>
</tbody></table>
<!--  END VCD4 PFV -->
<!-- ================== -->
<!-- Start Main Content -->
<!-- ================== --> 
<br>
<br>
<span class="byline">
<b>Short Course</b><br>
By 
<a href="http://www.jguru.com/">jGuru</a><br>
<!-- Date -->
</span>
<p>
[<a href="http://java.sun.com/developer/onlineTraining/JavaMail/">About This Short Course</a>|
<a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises.html">Exercises</a>]
</p>
<h4>Course Outline</h4>
<ul>
<li><a href="#JavaMailIntro">Introducing the JavaMail API</a></li>
<li><a href="#RelatedProtocols">Reviewing Related Protocols</a>
<ul>
<li><a href="#ProtocolSMTP">SMTP</a></li>
<li><a href="#ProtocolPOP3">POP</a></li>
<li><a href="#ProtocolIMAP">IMAP</a></li>
<li><a href="#ProtocolMIME">MIME</a></li>
<li><a href="#ProtocolNNTP">NNTP and Others</a></li>
</ul></li>
<li><a href="#JavaMailInstallation">Installing</a>
<ul>
<li><a href="#InstallJAF">Installing the JavaBeans Activation Framework</a></li>
<li><a href="#InstallJ2EE">Using with the Java 2 Enterprise Edition</a></li>
</ul></li>
<li><a href="#JavaCoreClasses">Reviewing the Core Classes</a>
<ul>
<li><a href="#JavaMailSession">Session</a></li>
<li><a href="#JavaMailMessage">Message</a></li>
<li><a href="#JavaMailInternetAddress">Address</a></li>
<li><a href="#JavaMailAuthenticator">Authenticator</a></li>
<li><a href="#JavaMailTransport">Transport</a></li>
<li><a href="#JavaMailFolder">Store and Folder</a></li>
<li><a href="#JavaMailMovingOn">Moving On</a></li>
</ul></li>
<li><a href="#JavaMailUsage">Using the JavaMail API</a>
<ul>
<li><a href="#JavaMailSending">Sending Messages</a></li>
<li><a href="#JavaMailFetching">Fetching Messages</a></li>
<li><a href="#JavaMailDeleting">Deleting Messages and Flags</a></li>
<li><a href="#JavaMailAuthenticating">Authenticating Yourself</a></li>
<li><a href="#JavaMailReplying">Replying to Messages</a></li>
<li><a href="#JavaMailForwarding">Forwarding Messages</a></li>
<li><a href="#JavaMailAttachments">Working with Attachments</a>
<ul>
<li><a href="#SendingAttachments">Sending Attachments</a></li>
<li><a href="#GettingAttachments">Getting Attachments</a></li>
</ul></li>
<li><a href="#ProcessingHTMLMessages">Processing HTML Messages</a>
<ul>
<li><a href="#BasicHTMLSending">Sending HTML Messages</a></li>
<li><a href="#IncludingImagesWithHTML">Including Images with Your Messages</a></li>
</ul></li>
</ul></li>
<li><a href="#JavaMailSearching">Searching with SearchTerm</a></li>
<li><a href="#JavaMailResources">Resources</a></li>
</ul><br><h3><a name="JavaMailIntro">Introducing the JavaMail API</a></h3>
<p>The JavaMail API is an optional package (standard extension) for
reading, composing, and sending electronic messages. You use the package to create <em>Mail User
Agent</em> (MUA) type programs, similar to Eudora, Pine, and Microsoft Outlook. Its main purpose is not
for transporting, delivering, and forwarding messages like sendmail or other <em>Mail Transfer Agent</em>
(MTA) type programs. In other words, users interact with MUA-type programs to read and write emails. MUAs
rely on MTAs to handle the actual delivery.</p>
<p>The JavaMail API is designed to provide protocol-independent access for sending and receiving messages
by dividing the API into two parts:</p>
<ul>
<li>The first part of the API is the focus of this 
course. Basically, how to send and receive messages independent of the 
provider/protocol.</li>
<li>The second part speaks the protocol-specific languages, like SMTP, POP, IMAP, and NNTP. With the
JavaMail API, in order to communicate with a server, you need a <em>provider</em> for a protocol. The
creation of protocol-specific providers is not covered in this course as Sun provides a sufficient set
for free.</li>
</ul>
<h3><a name="RelatedProtocols">Reviewing Related Protocols</a></h3>
<p>
Before looking into the JavaMail API specifics, step back and take a look at the protocols used with
the API. There are basically four that you'll come to know and love:
</p>
<ul>
<li>SMTP</li>
<li>POP</li>
<li>IMAP</li>
<li>MIME</li>
</ul>
<p>
You will also run across NNTP and some others. Understanding the basics of all the protocols will help
you understand how to use the JavaMail API. While the API is designed to be protocol agnostic, you can't
overcome the limitations of the underlying protocols. If a capability isn't supported by a chosen
protocol, the JavaMail API doesn't magically add the capability on top of it. (As you'll soon see, this
usually is a problem when working with POP.)
</p>
<h4><a name="ProtocolSMTP">SMTP</a></h4>
<p>
The Simple Mail Transfer Protocol (SMTP) is the mechanism for delivery of email. In the context of the
JavaMail API, your JavaMail-based program will communicate with your company or Internet Service
Provider's (ISP's) SMTP server. That SMTP server will relay the message on to the SMTP server of the
recipient(s) to eventually be acquired by the user(s) through POP or IMAP. This does not require your
SMTP server to be an open relay, as authentication is supported, but it is your responsibility to ensure
the SMTP server is configured properly. There is nothing in the JavaMail API for tasks like configuring a
server to relay messages or to add and remove email accounts.
</p>
<h4><a name="ProtocolPOP3">POP</a></h4>
<p>
POP stands for Post Office Protocol. Currently in version 3, also known as POP3, <a href="http://www.imc.org/rfc1939">RFC 1939</a> defines this protocol. POP is the mechanism most people on
the Internet use to get their mail. It defines support for a single mailbox for each user. That is all it
does, and that is also the source of most confusion. Much of what people are familiar with when using
POP, like the ability to see how many new mail messages they have, are not supported by POP at all. These
capabilities are built into programs like Eudora or Microsoft Outlook, which remember things like the
last mail received and calculate how many are new for you. So, when using the JavaMail API, if you want
this type of information, you have to calculate it yourself.
</p>
<h4><a name="ProtocolIMAP">IMAP</a></h4>
<p>
IMAP is a more advanced protocol for receiving messages. Defined in <a href="http://www.imc.org/rfc2060">RFC 2060</a>, IMAP stands for Internet Message Access Protocol, and is
currently in version 4, also known as IMAP4. When using IMAP, your mail server must support the protocol.
You can't just change your program to use IMAP instead of POP and expect everything in IMAP to be
supported. Assuming your mail server supports IMAP, your JavaMail-based program can take advantage of
users having multiple folders on the server and these folders can be shared by multiple users.
</p>
<p>
Due to the more advanced capabilities, you might think IMAP would be used by everyone. It isn't. It
places a much heavier burden on the mail server, requiring the server to receive the new messages,
deliver them to users when requested, <em>and</em> maintain them in multiple folders for each user. While
this does centralize backups, as users' long-term mail folders get larger and larger, everyone suffers
when disk space is exhausted. With POP, saved messages get offloaded from the mail server.
</p>
<h4><a name="ProtocolMIME">MIME</a></h4>
<p>
MIME stands for Multipurpose Internet Mail Extensions. It is not a mail transfer protocol. Instead, it
defines the content of what is transferred: the format of the messages, attachments, and so on. There are
many different documents that take effect here: <a href="http://www.imc.org/rfc822">RFC 822</a>, <a href="http://www.imc.org/rfc2045">RFC 2045</a>, <a href="http://www.imc.org/rfc2046">RFC 2046</a>, and <a href="http://www.imc.org/rfc2047">RFC 2047</a>. As a user of the JavaMail API, you usually don't need to
worry about these formats. However, these formats do exist and are used by your programs.
</p>
<h4><a name="ProtocolNNTP">NNTP and Others</a></h4>
<p>
Because of the split of the JavaMail API between provider and everything else, you can easily add
support for additional protocols. Sun maintains a list of <a href="http://java.sun.com/products/javamail/Third_Party.html">third-party providers</a> that take
advantage of protocols that Sun doesn't provide support for, out-of-the-box. There, you'll find support
for NNTP (Network News Transport Protocol) [newsgroups], S/MIME (Secure Multipurpose Internet Mail
Extensions), and more.
</p>
<h3><a name="JavaMailInstallation">Installing</a></h3>
<p>
To use the JavaMail API, download the JavaMail implementation, unbundle the <code>javamail-[version].zip</code> file, and add the <code>mail.jar</code> file to your CLASSPATH. The implementation comes with an SMTP, IMAP4, and POP3 provider besides the core classes.</p>
<table align="center" border="1" width="80%">
<tbody><tr>
<td>
<p><strong>Note:</strong> After installing Sun's JavaMail implementation, you can find many example
programs in the <code>demo</code> directory.</p>
</td>
</tr>
</tbody></table>
<p>
After installing JavaMail, <a href="#InstallJAF">install the JavaBeans Activation Framework</a>. </p>
<h4><a name="InstallJAF">Installing the JavaBeans Activation Framework</a></h4>
<p>
All versions of the JavaMail API require the JavaBeans Activation 
Framework. The framework adds support for typing arbitrary blocks of 
data and handling it accordingly. This doesn't sound like much, but it 
is your basic MIME-type support found in many browsers and mail tools, 
today. After <a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/jaf.html">downloading</a> the framework, unbundle the <code>jaf-[version].zip</code> file, and add the <code>activation.jar</code> file to your CLASSPATH.</p>
<p>
You should now have added <code>mail.jar</code> and <code>activation.jar</code> to your CLASSPATH.</p>
<p>
If you don't want to change the CLASSPATH environment variable, copy the JAR files to your <code>lib/ext</code>
 directory under the Java Runtime Environment (JRE) directory. For 
instance, for the J2SE 1.3 release, the default directory would be <code>C:\jdk1.3\jre\lib\ext</code> on a Windows platform.</p>
<h4><a name="InstallJ2EE">Using with the Java 2 Enterprise Edition</a></h4>
<p>
If you use J2EE, there is nothing special you have to do to use the 
basic JavaMail API; it comes with the J2EE classes. Just make sure the <code>j2ee.jar</code> file is in your CLASSPATH and you're all set.</p>
<h3>Exercise</h3>
<blockquote>
<ol>
<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailSetup/index.html">Setting Up Your JavaMail Environment</a></li>
</ol></blockquote>
<h3><a name="JavaCoreClasses">Reviewing the Core Classes</a></h3>
<p>
Before taking a how-to approach at looking at the JavaMail classes in depth, the following walks you
through the core classes that make up the API: <code>Session</code>, <code>Message</code>,
<code>Address</code>, <code>Authenticator</code>, <code>Transport</code>, <code>Store</code>, and
<code>Folder</code>. All these classes are found in the top-level package for the JavaMail API:
<code>javax.mail</code>, though you'll frequently find yourself using subclasses found in the
<code>javax.mail.internet</code> package.
</p>
<h4><a name="JavaMailSession">Session</a></h4>
<p>
The <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Session.html">Session</a></code> class
defines a basic mail session. It is through this session that everything else works. The
<code>Session</code> object takes advantage of a <code><a href="http://java.sun.com/j2se/1.3/docs/api/java/util/Properties.html">java.util.Properties</a></code>
object to get information like mail server, username, password, and other information that can be shared
across your entire application.
</p>
<p>
The constructors for the class are private. You can get a single default session that can be shared
with the <code>getDefaultInstance()</code> method:
</p>
<pre>Properties props = new Properties();
// fill props with any information
Session session = Session.getDefaultInstance(props, null);
</pre>
<p>
Or, you can create a unique session with <code>getInstance()</code>:
</p>
<pre>Properties props = new Properties();
// fill props with any information
Session session = Session.getInstance(props, null);
</pre>
<p>
In both cases here the <code>null</code> argument is an <code>Authenticator</code> object which is not
being used at this time. More on <a href="#JavaMailAuthenticator">Authenticator</a> shortly.
</p>
<p>
In most cases, it is sufficient to use the shared session, even if working with mail sessions for
multiple user mailboxes. You can add the username and password combination in at a later step in the
communication process, keeping everything separate.
</p>
<h4><a name="JavaMailMessage">Message</a></h4>
<p>
Once you have your <code>Session</code> object, it is time to move on to creating the message to send.
This is done with a type of <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Message.html">Message</a></code>.
Being an abstract class, you must work with a subclass, in most cases <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/internet/MimeMessage.html">
javax.mail.internet.MimeMessage</a></code>. A <code>MimeMessage</code> is a email message that
understands MIME types and headers, as defined in the different RFCs. Message headers are restricted to
US-ASCII characters only, though non-ASCII characters can be encoded in certain header fields.
</p>
<p>
To create a <code>Message</code>, pass along the <code>Session</code> object to the
<code>MimeMessage</code> constructor:
</p>
<pre>MimeMessage message = new MimeMessage(session);
</pre>
<table align="center" border="1" width="80%">
<tbody><tr>
<td>
<p><strong>Note:</strong> There are other constructors, like for creating messages from RFC822-formatted
input streams.</p>
</td>
</tr>
</tbody></table>
<p>
Once you have your message, you can set its parts, as <code>Message</code> implements the <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Part.html">Part</a></code> interface (with <code>MimeMessage</code> implementing <code><code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/internet/MimePart.html">MimePart</a></code></code>). The basic mechanism to set the content is the <code>setContent()</code> method, with
arguments for the content and the mime type:
</p>
<pre>message.setContent("Hello", "text/plain");
</pre>
<p>
If, however, you know you are working with a <code>MimeMessage</code> and your message is plain text,
you can use its <code>setText()</code> method which only requires the actual content, defaulting to the
MIME type of text/plain:
</p>
<pre>message.setText("Hello");
</pre>
<p>
For plain text messages, the latter form is the preferred mechanism to set the content. For sending
other kinds of messages, like HTML messages, use the former. More on HTML messages <a href="#BasicHTMLSending">later</a> though.</p>
<p>For setting the subject, use the <code>setSubject()</code> method:</p>
<pre>message.setSubject("First");
</pre>
<h4><a name="JavaMailInternetAddress">Address</a></h4>
<p>
Once you've created the <code>Session</code> and the <code>Message</code>, as well as filled the
message with content, it is time to address your letter with an <code><code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Address.html">Address</a></code></code>.
Like <code>Message</code>, <code>Address</code> is an abstract class. You use the <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/internet/InternetAddress.html">
javax.mail.internet.InternetAddress</a></code> class.
</p>
<p>
To create an address with just the email address, pass the email address to the constructor:
</p>
<code>
Address address = new InternetAddress("president@whitehouse.gov");
</code>
<p>
If you want a name to appear next to the email address, you can pass that along to the constructor,
too:
</p>
<code>
Address address = new InternetAddress("president@whitehouse.gov", "George Bush");
</code>
<p>
You will need to create address objects for the message's <em>from</em> field as well as the
<em>to</em> field. Unless your mail server prevents you, there is nothing stopping you from sending a
message that appears to be from anyone.
</p>
<p>
Once you've created the addresses, you connect them to a message in one of two ways. For identifying
the sender, you use the <code>setFrom()</code> and <code>setReplyTo()</code> methods.
</p>
<pre>message.setFrom(address)
</pre>
<p>
If your message needs to show multiple from addresses, use the <code>addFrom()</code> method:
</p>
<pre>Address address[] = ...;
message.addFrom(address);
</pre>
<p>
For identifying the message recipients, you use the <code>addRecipient()</code> method. This method
requires a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Message.RecipientType.html">
Message.RecipientType</a></code> besides the address.
</p>
<pre>message.addRecipient(type, address)
</pre>
<p>The three predefined types of address are:</p>
<ul>
<li>Message.RecipientType.TO</li>
<li>Message.RecipientType.CC</li>
<li>Message.RecipientType.BCC</li>
</ul>
<p>
So, if the message was to go to the vice president, sending a carbon copy to the first lady, the
following would be appropriate:
</p>
<code>
Address toAddress = new InternetAddress("vice.president@whitehouse.gov");<br>
Address ccAddress = new InternetAddress("first.lady@whitehouse.gov");<br>
message.addRecipient(Message.RecipientType.TO, toAddress);<br>
message.addRecipient(Message.RecipientType.CC, ccAddress);<br>
</code>
<p>
The JavaMail API provides no mechanism to check for the validity of an email address. While you can
program in support to scan for valid characters (as defined by RFC 822) or verify the MX (mail exchange)
record yourself, these are all beyond the scope of the JavaMail API.
</p>
<h4><a name="JavaMailAuthenticator">Authenticator</a></h4>
<p>
Like the <code>java.net</code> classes, the JavaMail API can take advantage of an <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Authenticator.html">Authenticator</a></code> to access protected resources via a username and password. For the JavaMail API, that resource is the
mail server. The JavaMail <code>Authenticator</code> is found in the <code>javax.mail</code> package and
is different from the <code>java.net</code> class of the same name. The two don't share the same
<code>Authenticator</code> as the JavaMail API works with Java 1.1, which didn't have the
<code>java.net</code> variety.
</p>
<p>
To use the <code>Authenticator</code>, you subclass the abstract class and return a <code><code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/PasswordAuthentication.html">
PasswordAuthentication</a></code></code> instance from the <code>getPasswordAuthentication()</code>
method. You must register the <code>Authenticator</code> with the session when created. Then, your
<code>Authenticator</code> will be notified when authentication is necessary. You could popup a window or
read the username and password from a configuration file (though if not encrypted it is not secure),
returning them to the caller as a <code>PasswordAuthentication</code> object.
</p>
<pre>Properties props = new Properties();
// fill props with any information
Authenticator auth = new MyAuthenticator();
Session session = Session.getDefaultInstance(props, auth);
</pre>
<h4><a name="JavaMailTransport">Transport</a></h4>
<p>
The final part of sending a message is to use the <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Transport.html">Transport</a></code>
class. This class speaks the protocol-specific language for sending the message (usually SMTP). It's an
abstract class and works something like <code>Session</code>. You can use the <em>default</em> version of
the class by just calling the static <code>send()</code> method:
</p>
<pre>Transport.send(message);
</pre>
<p>
Or, you can get a specific instance from the session for your protocol, pass along the username and
password (blank if unnecessary), send the message, and close the connection:
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>message.saveChanges(); // implicit with send()
Transport transport = session.getTransport("smtp");
transport.connect(host, username, password);
transport.sendMessage(message, message.getAllRecipients());
transport.close();
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
This latter way is best when you need to send multiple messages, as it will keep the connection with
the mail server active between messages. The basic <code>send()</code> mechanism makes a separate
connection to the server for each method call.
</p>
<table align="center" border="1" width="80%">
<tbody><tr>
<td>
<p>
<strong>Note:</strong> To watch the mail commands go by to the mail server, set the debug flag with
<code>session.setDebug(true)</code>.
</p>
</td>
</tr>
</tbody></table>
<h4><a name="JavaMailFolder">Store and Folder</a></h4>
<p>
Getting messages starts similarly to sending messages, with a <code>Session</code>. However, after
getting the session, you connect to a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Store.html">Store</a></code>, quite
possibly with a username and password or <code>Authenticator</code>. Like <code>Transport</code>, you
tell the <code>Store</code> what protocol to use:
</p>
<pre>// Store store = session.getStore("imap");
Store store = session.getStore("pop3");
store.connect(host, username, password);
</pre>
<p>
After connecting to the <code>Store</code>, you can then get a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Folder.html">Folder</a></code>, which
must be opened before you can read messages from it:
</p>
<pre>Folder folder = store.getFolder("INBOX");
folder.open(Folder.READ_ONLY);
Message message[] = folder.getMessages();
</pre>
<p>
For POP3, the only folder available is the <code>INBOX</code>. If you are using IMAP, you can have
other folders available.
</p>
<table align="center" border="1" width="80%">
<tbody><tr>
<td>
<p>
<strong>Note:</strong> Sun's providers are meant to be smart. While <code>Message message[] =
folder.getMessages();</code> might look like a slow operation reading every message from the server, only
when you actually need to get a part of the message is the message content retrieved.
</p>
</td>
</tr>
</tbody></table>
<p>
Once you have a <code>Message</code> to read, you can get its content with <code>getContent()</code>
or write its content to a stream with <code>writeTo()</code>. The <code>getContent()</code> method only
gets the message content, while <code>writeTo()</code> output includes headers.
</p>
<pre>System.out.println(((MimeMessage)message).getContent());
</pre>
<p>
Once you're done reading mail, close the connection to the folder and store.
</p>
<pre>folder.close(aBoolean);
store.close();
</pre>
<p>
The boolean passed to the <code>close()</code> method of folder states whether or not to update the
folder by removing deleted messages.
</p>
<h4><a name="JavaMailMovingOn">Moving On</a></h4>
<p>
Essentially, understanding how to use these seven classes is all you need for nearly everything with
the JavaMail API. Most of the other capabilities of the JavaMail API build off these seven classes to do
something a little different or in a particular way, like if the content is an attachment. Certain tasks,
like searching, are isolated, and are discussed <a href="#JavaMailSearching">later</a>.
</p>
<h3><a name="JavaMailUsage">Using the JavaMail API</a></h3>
<p>
You've seen how to work with the core parts of the JavaMail API. In the following sections you'll find
a how-to approach for connecting the pieces to do specific tasks.
</p>
<h4><a name="JavaMailSending">Sending Messages</a></h4>
<p>
Sending an email message involves getting a session, creating and filling a message, and sending it.
You can specify your SMTP server by setting the <code>mail.smtp.host</code> property for the
<code>Properties</code> object passed when getting the <code>Session</code>:
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>String host = ...;
String from = ...;
String to = ...;

// Get system properties
Properties props = System.getProperties();

// Setup mail server
props.put("mail.smtp.host", host);

// Get session
Session session = Session.getDefaultInstance(props, null);

// Define message
MimeMessage message = new MimeMessage(session);
message.setFrom(new InternetAddress(from));
message.addRecipient(Message.RecipientType.TO, 
  new InternetAddress(to));
message.setSubject("Hello JavaMail");
message.setText("Welcome to JavaMail");

// Send message
Transport.send(message);
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>You should place the code in a try-catch block, as setting up the message and sending it can throw
exceptions.
</p>
<h3>Exercise</h3>
<blockquote>
<ol start="2">
....<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailSending/">Sending Your First
Message</a></li>
</ol></blockquote><h4><a name="JavaMailFetching">Fetching Messages</a></h4>
<p>For reading mail, you get a session, get and connect to an appropriate store for your mailbox, open
the appropriate folder, and get your message(s). Also, don't forget to close the connection when
done.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>String host = ...;
String username = ...;
String password = ...;

// Create empty properties
Properties props = new Properties();

// Get session
Session session = Session.getDefaultInstance(props, null);

// Get the store
Store store = session.getStore("pop3");
store.connect(host, username, password);

// Get folder
Folder folder = store.getFolder("INBOX");
folder.open(Folder.READ_ONLY);

// Get directory
Message message[] = folder.getMessages();

for (int i=0, n=message.length; i&lt;n; i++) {
   System.out.println(i + ": " + message[i].getFrom()[0] 
     + "\t" + message[i].getSubject());
}

// Close connection 
folder.close(false);
store.close();
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
What you do with each message is up to you. The above code block just displays who the message is from
and the subject. Technically speaking, the list of from addresses could be empty and the
<code>getFrom()[0]</code> call could throw an exception.
</p>
<p>
To display the whole message, you can prompt the user after seeing the from and subject fields, and
then call the message's <code>writeTo()</code> method if they want to see it.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>BufferedReader reader = new BufferedReader (
  new InputStreamReader(System.in));

// Get directory
Message message[] = folder.getMessages();
for (int i=0, n=message.length; i&lt;n; i++) {
  System.out.println(i + ": " + message[i].getFrom()[0] 
    + "\t" + message[i].getSubject());

  System.out.println("Do you want to read message? " +
    "[YES to read/QUIT to end]");
  String line = reader.readLine();
  if ("YES".equals(line)) {
    message[i].writeTo(System.out);
  } else if ("QUIT".equals(line)) {
    break;
  }
}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h3>Exercise</h3>
<blockquote>
<ol start="3">
<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailGetting/">Checking for Mail</a></li>
</ol></blockquote><h4><a name="JavaMailDeleting">Deleting Messages and Flags</a></h4>
<p>
Deleting messages involves working with the <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Flags.html">Flags</a></code> associated
with the messages. There are different flags for different states, some system-defined and some
user-defined. The predefined flags are defined in the inner class <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Flags.Flag.html">Flags.Flag</a></code>
and are listed below:
</p>
<ul>
<li><code>Flags.Flag.ANSWERED</code></li>
<li><code>Flags.Flag.DELETED</code></li>
<li><code>Flags.Flag.DRAFT</code></li>
<li><code>Flags.Flag.FLAGGED</code></li>
<li><code>Flags.Flag.RECENT</code></li>
<li><code>Flags.Flag.SEEN</code></li>
<li><code>Flags.Flag.USER</code></li>
</ul>
<p>
Just because a flag exists doesn't mean the flag is supported by all mail servers/providers. For
instance, besides deleting messages, the POP protocol supports none of them. Checking for <em>new</em>
mail is not a POP task but one built into mail clients. To find out what flags are supported, ask the
folder with <code>getPermanentFlags()</code>.</p>
<p>To delete messages, you set the message's <code>DELETED</code> flag:
</p>
<pre>message.setFlag(Flags.Flag.DELETED, true);
</pre>
<p>Open up the folder in <code>READ_WRITE</code> mode first though:</p>
<pre>folder.open(Folder.READ_WRITE);
</pre>
<p>
Then, when you are done processing all messages, close the folder, passing in a true value to
<em>expunge</em> the deleted messages.</p>
<pre>folder.close(true);
</pre>
<p>
There is an <code>expunge()</code> method of <code>Folder</code> that can be used to delete the
messages. However, it doesn't work for Sun's POP3 provider. Other providers may or may not implement the
capabilities. It will more than likely be implemented for IMAP providers. Because POP only supports
single access to the mailbox, you have to close the folder to delete the messages with Sun's
provider.
</p>
<p>
To unset a flag, just pass false to the <code>setFlag()</code> method. To see if a flag is set, check
with <code>isSet()</code>.
</p>
<h4><a name="JavaMailAuthenticating">Authenticating Yourself</a></h4>
<p>
You <a href="#JavaMailAuthenticator">previously</a> learned that you can use an
<code>Authenticator</code> to prompt for username and password when needed, instead of passing them in as
strings. Here you'll actually see how to more fully use authentication.</p>
<p>Instead of connecting to the <code>Store</code> with the host, username, and password, you configure
the <code>Properties</code> to have the host, and tell the <code>Session</code> about your custom
<code>Authenticator</code> instance, as shown here:
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>// Setup properties
Properties props = System.getProperties();
props.put("mail.pop3.host", host);

// Setup authentication, get session
Authenticator auth = new PopupAuthenticator();
Session session = Session.getDefaultInstance(props, auth);

// Get the store
Store store = session.getStore("pop3");
store.connect();
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
You then subclass <code>Authenticator</code> and return a <code>PasswordAuthentication</code> object
from the <code>getPasswordAuthentication()</code> method. The following is one such implementation, with
a single field for both. As this isn't a Project Swing tutorial, just enter the two parts in the one
field, separated by a comma.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>import javax.mail.*;
import javax.swing.*;
import java.util.*;

public class PopupAuthenticator extends Authenticator {

  public PasswordAuthentication getPasswordAuthentication() {
    String username, password;

    String result = JOptionPane.showInputDialog(
      "Enter 'username,password'");

    StringTokenizer st = new StringTokenizer(result, ",");
    username = st.nextToken();
    password = st.nextToken();

    return new PasswordAuthentication(username, password);
  }

}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
Since the <code>PopupAuthenticator</code> relies on Swing, it will start up the event-handling thread
for AWT. This basically requires you to add a call to <code>System.exit()</code> in your code to stop the
program.
</p>
<h4><a name="JavaMailReplying">Replying to Messages</a></h4>
<p>The <code>Message</code> class includes a <code>reply()</code> method to configure a new
<code>Message</code> with the proper recipient and subject, adding "Re: " if not already there. This does
not add any content to the message, only copying the <em>from</em> or <em>reply-to</em> header to the new
recipient. The method takes a boolean parameter indicating whether to reply to only the sender (false) or
reply to all (true).</p>
<pre>MimeMessage reply = (MimeMessage)message.reply(false);
reply.setFrom(new InternetAddress("president@whitehouse.gov"));
reply.setText("Thanks");
Transport.send(reply);
</pre>
<p>To configure the <em>reply-to</em> address when sending a message, use the <code>setReplyTo()</code>
method.</p><h3>Exercise</h3>
<blockquote>
<ol start="4">
<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailReply/">Replying to Mail</a></li>
</ol></blockquote><h4><a name="JavaMailForwarding">Forwarding Messages</a></h4>
<p>Forwarding messages is a little more involved. There is no single method to call, and you build up the
message to forward by working with the parts that make up a message.
</p>
<p>A mail message can be made up of multiple parts. Each part is a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/BodyPart.html">BodyPart</a></code>, or
more specifically, a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/internet/MimeBodyPart.html">MimeBodyPart
</a></code> when working with MIME messages. The different body parts get combined into a container
called <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/Multipart.html">Multipart</a></code> or,
again, more specifically a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/internet/MimeMultipart.html">
MimeMultipart</a></code>. To forward a message, you create one part for the text of your message
and a second part with the message to forward, and combine the two into a multipart. Then you add the
multipart to a properly addressed message and send it.</p>
<p>That's essentially it. To copy the content from one message to another, just copy over its
<code><a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/javadocs/javax/activation/DataHandler.html">DataHandler</a></code>, a class from the JavaBeans Activation Framework.</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>// Create the message to forward
Message forward = new MimeMessage(session);

// Fill in header
forward.setSubject("Fwd: " + message.getSubject());
forward.setFrom(new InternetAddress(from));
forward.addRecipient(Message.RecipientType.TO, 
  new InternetAddress(to));

// Create your new message part
BodyPart messageBodyPart = new MimeBodyPart();
messageBodyPart.setText(
  "Here you go with the original message:\n\n");

// Create a multi-part to combine the parts
Multipart multipart = new MimeMultipart();
multipart.addBodyPart(messageBodyPart);

// Create and fill part for the forwarded content
messageBodyPart = new MimeBodyPart();
messageBodyPart.setDataHandler(message.getDataHandler());

// Add part to multi part
multipart.addBodyPart(messageBodyPart);

// Associate multi-part with message
forward.setContent(multipart);

// Send message
Transport.send(forward);
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h4><a name="JavaMailAttachments">Working with Attachments</a></h4>
<p>Attachments are resources associated with a mail message, usually kept outside of the message like a
text file, spreadsheet, or image. As with common mail programs like Eudora and pine, you can
<em>attach</em> resources to your mail message with the JavaMail API and get those attachments when you
receive the message.
</p>
<h5><a name="SendingAttachments">Sending Attachments</a></h5>
<p>
Sending attachments is quite like forwarding messages. You build up the parts to make the complete
message. After the first part, your message text, you add other parts where the <code>DataHandler</code>
for each is your attachment, instead of the shared handler in the case of a forwarded message. If you are
reading the attachment from a file, your attachment data source is a <code><a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/javadocs/javax/activation/FileDataSource.html">
FileataSource</a></code>. Reading from a URL, it is a <code><a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/javadocs/javax/activation/URLDataSource.html">
URLDataSource</a></code>. Once you have your <code>DataSource</code>, just pass it on to the
<code><a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/javadocs/javax/activation/DataHandler.html">
DataHandler</a></code> constructor, before finally attaching it to the <code>BodyPart</code> with
<code>setDataHandler()</code>. Assuming you want to retain the original filename for the attachment, the
last thing to do is to set the filename associated with the attachment with the
<code>setFileName()</code> method of <code>BodyPart</code>. All this is shown here:
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>// Define message
Message message = new MimeMessage(session);
message.setFrom(new InternetAddress(from));
message.addRecipient(Message.RecipientType.TO, 
  new InternetAddress(to));
message.setSubject("Hello JavaMail Attachment");

// Create the message part 
BodyPart messageBodyPart = new MimeBodyPart();

// Fill the message
messageBodyPart.setText("Pardon Ideas");

Multipart multipart = new MimeMultipart();
multipart.addBodyPart(messageBodyPart);

// Part two is attachment
messageBodyPart = new MimeBodyPart();
DataSource source = new FileDataSource(filename);
messageBodyPart.setDataHandler(new DataHandler(source));
messageBodyPart.setFileName(filename);
multipart.addBodyPart(messageBodyPart);

// Put parts in message
message.setContent(multipart);

// Send the message
Transport.send(message);
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
When including attachments with your messages, if your program is a servlet, your users must upload
the attachment besides tell you where to send the message. Uploading each file can be handled with a form
encoding type of <code>multipart/form-data</code>.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>&lt;FORM ENCTYPE="multipart/form-data" 
    method=post action="/myservlet"&gt; 
  &lt;INPUT TYPE="file" NAME="thefile"&gt;
  &lt;INPUT TYPE="submit" VALUE="Upload"&gt;
&lt;/FORM&gt;
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<table align="center" border="1" width="80%">
<tbody><tr>
<td>
<p>
<strong>Note:</strong> Message size is limited by your SMTP server, not the JavaMail API. If you run
into problems, consider increasing the Java heap size by setting the <code>ms</code> and <code>mx</code>
parameters.
</p>
</td>
</tr>
</tbody></table><h3>Exercise</h3>
<blockquote>
<ol start="5">
<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailAttach/">Sending Attachments</a></li>
</ol></blockquote>
<h5><a name="GettingAttachments">Getting Attachments</a></h5>
<p>
Getting attachments out of your messages is a little more involved then sending them, as MIME has no
simple notion of attachments. The content of your message is a <code>Multipart</code> object when it has
attachments. You then need to process each <code>Part</code>, to get the main content and the
attachment(s). Parts marked with a disposition of <code>Part.ATTACHMENT</code> from
<code>part.getDisposition()</code> are clearly attachments. However, attachments can also come across
with no disposition (and a non-text MIME type) or a disposition of <code>Part.INLINE</code>. When the
disposition is either <code>Part.ATTACHMENT</code> or <code>Part.INLINE</code>, you can save off the
content for that message part. Just get the original filename with <code>getFileName()</code> and the
input stream with <code>getInputStream()</code>.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>Multipart mp = (Multipart)message.getContent();

for (int i=0, n=multipart.getCount(); i&lt;n; i++) {
  Part part = multipart.getBodyPart(i));

  String disposition = part.getDisposition();

  if ((disposition != null) &amp;&amp; 
      ((disposition.equals(Part.ATTACHMENT) || 
       (disposition.equals(Part.INLINE))) {
    saveFile(part.getFileName(), part.getInputStream());
  }
}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
The <code>saveFile()</code> method just creates a <code>File</code> from the filename, reads the bytes
from the input stream, and writes them off to the file. In case the file already exists, a number is
added to the end of the filename until one is found that doesn't exist.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>// from saveFile()
File file = new File(filename);
for (int i=0; file.exists(); i++) {
  file = new File(filename+i);
}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<p>
The code above covers the simplest case where message parts are flagged appropriately. To cover all
cases, handle when the disposition is null and get the MIME type of the part to handle accordingly.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>if (disposition == null) {
  // Check if plain
  MimeBodyPart mbp = (MimeBodyPart)part;
  if (mbp.isMimeType("text/plain")) {
    // Handle plain
  } else {
    // Special non-attachment cases here of 
    // image/gif, text/html, ...
  }
...
}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h4><a name="ProcessingHTMLMessages">Processing HTML Messages</a></h4>
<p>
Sending HTML-based messages can be a little more work than sending plain text messages, though it
doesn't have to be that much more work. It all depends on your specific requirements.
</p>
<h5><a name="BasicHTMLSending">Sending HTML Messages</a></h5>
<p>
If all you need to do is send the equivalent of an HTML file as the message and let the mail reader
worry about fetching any embedded images or related pieces, use the <code>setContent()</code> method of
<code>Message</code>, passing along the content as a <code>String</code> and setting the content type to
<code>text/html</code>.
</p>
<pre>String htmlText = "&lt;H1&gt;Hello&lt;/H1&gt;" + 
  "&lt;img src=\"http://www.jguru.com/images/logo.gif\"&gt;";
message.setContent(htmlText, "text/html"));
</pre>
<p>On the receiving end, if you fetch the message with the JavaMail API, there is nothing built into the
API to display the message as HTML. The JavaMail API only sees it as a stream of bytes. To display the
message as HTML, you must either use the Swing <code>JEditorPane</code> or some third-party HTML viewer
component.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>if (message.getContentType().equals("text/html")) {
  String content = (String)message.getContent();
  JFrame frame = new JFrame();
  JEditorPane text = new JEditorPane("text/html", content);
  text.setEditable(false);
  JScrollPane pane = new JScrollPane(text);
  frame.getContentPane().add(pane);
  frame.setSize(300, 300);
  frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
  frame.show();
}
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h5><a name="IncludingImagesWithHTML">Including Images with Your Messages</a></h5>
<p>
On the other hand, if you want your HTML content message to be complete, with embedded images included
as part of the message, you must treat the image as an attachment and reference the image with a special
<code>cid</code> URL, where the <code>cid</code> is a reference to the <code>Content-ID</code> header of
the image attachment.
</p>
<p>
The process of embedding an image is quite similar to attaching a file to a message, the only
difference is that you have to tell the <code>MimeMultipart</code> that the parts are related by setting
its subtype in the constructor (or with <code>setSubType()</code>) and set the <code>Content-ID</code>
header for the image to a random string which is used as the <code>src</code> for the image in the
<code>img</code> tag. The following demonstrates this completely.
</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>String file = ...;

// Create the message
Message message = new MimeMessage(session);

// Fill its headers
message.setSubject("Embedded Image");
message.setFrom(new InternetAddress(from));
message.addRecipient(Message.RecipientType.TO, 
  new InternetAddress(to));

// Create your new message part
BodyPart messageBodyPart = new MimeBodyPart();
String htmlText = "&lt;H1&gt;Hello&lt;/H1&gt;" + 
  "&lt;img src=\"cid:memememe\"&gt;";
messageBodyPart.setContent(htmlText, "text/html");

// Create a related multi-part to combine the parts
MimeMultipart multipart = new MimeMultipart("related");
multipart.addBodyPart(messageBodyPart);

// Create part for the image
messageBodyPart = new MimeBodyPart();

// Fetch the image and associate to part
DataSource fds = new FileDataSource(file);
messageBodyPart.setDataHandler(new DataHandler(fds));
messageBodyPart.setHeader("Content-ID","&lt;memememe&gt;");

// Add part to multi-part
multipart.addBodyPart(messageBodyPart);

// Associate multi-part with message
message.setContent(multipart);
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h3>Exercise</h3>
<blockquote>
<ol start="6">
<li><a href="http://java.sun.com/developer/onlineTraining/JavaMail/exercises/MailHtml/">Sending HTML Messages with
Images</a></li>
</ol></blockquote><h3><a name="JavaMailSearching">Searching with SearchTerm</a></h3>
<p>The JavaMail API includes a filtering mechanism found in the <code>javax.mail.search</code> package to
build up a <code><a href="http://java.sun.com/products/javamail/javadocs/javax/mail/search/SearchTerm.html">SearchTerm</a></code>. Once built, you then ask a <code>Folder</code> what messages match, retrieving an array of
<code>Message</code> objects:</p>
<pre>SearchTerm st = ...;
Message[] msgs = folder.search(st);
</pre>
<p>There are 22 different classes available to help you build a search term.</p>
<ul>
<li>AND terms (class <code>AndTerm</code>)</li>
<li>OR terms (class <code>OrTerm</code>)</li>
<li>NOT terms (class <code>NotTerm</code>)</li>
<li>SENT DATE terms (class <code>SentDateTerm</code>)</li>
<li>CONTENT terms (class <code>BodyTerm</code>)</li>
<li>HEADER terms (<code>FromTerm</code> / <code>FromStringTerm</code>, <code>RecipientTerm</code> /
<code>RecipientStringTerm</code>, <code>SubjectTerm</code>, etc.)</li>
</ul>
<p>Essentially, you build up a logical expression for matching messages, then search. For instance the
following term searches for messages with a (partial) subject string of <code>ADV</code> or a from field
of <code>friend@public.com</code>. You might consider periodically running this query and automatically
deleting any messages returned.</p>
<!-- BEGIN VCD7 CODE SAMPLE COMPONENT  -->
<table class="grey4" border="0" cellpadding="10" cellspacing="0" width="100%">
<tbody><tr><td><pre>SearchTerm st = 
  new OrTerm(
    new SubjectTerm("ADV:"), 
    new FromStringTerm("friend@public.com"));
Message[] msgs = folder.search(st);
</pre></td></tr></tbody></table>
<span class="sp20"> </span><br>
<!-- END VCD7 CODE SAMPLE COMPONENT  -->
<h3><a name="JavaMailResources">Resources</a></h3>
<p>You can do much more with the JavaMail API than what's described here. The lessons and exercises found
here can be supplemented by the following resources:</p>
<ul>
<li><a href="http://java.sun.com/products/javamail/index.jsp">JavaMail API Home</a></li>
<li><a href="http://java.sun.com/javase/technologies/desktop/javabeans/glasgow/jaf.html">JavaBeans Activation Framework
Home</a></li>
<li><a href="http://mail.java.sun.com/archives/javamail-interest.html">javamail-interest mailing
list</a></li>
<li><a href="http://java.sun.com/products/javamail/FAQ.html">Sun's JavaMail FAQ</a></li>
<li><a href="http://www.jguru.com/faq/JavaMail">jGuru's JavaMail FAQ</a></li>
<li><a href="http://java.sun.com/products/javamail/Third_Party.html">Third Party Products
List</a></li>
</ul>
<p>Copyright 1996-2001 <a href="http://www.jguru.com/">jGuru.com</a>. All Rights Reserved.</p>
<!-- ================ -->
<!-- End Main Content -->
<!-- ================ -->
<!-- =================== -->
<!-- END OF MAIN CONTENT -->
<!-- =================== -->
<!--stopindex-->
<!-- END CENTRAL COLUMN COMPONENTS -->
</td><td valign="top">
<!-- BEGIN RIGHT COLUMN COMPONENTS -->
<!-- END RIGHT COLUMN COMPONENTS -->
</td></tr>
<!-- BEGIN SPACER ROW -->
<tr><td><img src="emailcontents_files/a_002.gif" alt=" " border="0" height="1" width="560"></td><td><img src="emailcontents_files/a_002.gif" alt=" " border="0" height="1" width="170"></td></tr>
<!-- END SPACER ROW -->
</tbody></table>
<!-- END WRAPPER TABLE, 2 COLUMN, MAIN/RIGHT -->
<!-- BEGIN PC1 COMPONENT V.2 -->
<div class="pc1 pc1v2" style="margin:0 10px">
<div class="pc1w1"><div class="pc1w2"><div class="pc1w3 cornerBL"><div class="pc1w4">
<p>Oracle is reviewing the Sun product roadmap and will provide guidance
 to customers in accordance with Oracle's standard product communication
 policies. Any resulting features and timing of release of such features
 as determined by Oracle's review of roadmaps, are at the sole 
discretion of Oracle. All product roadmap information, whether 
communicated by Sun Microsystems or by Oracle, does not represent a 
commitment to deliver any material, code, or functionality, and should 
not be relied upon in making purchasing decisions. It is intended for 
information purposes only, and may not be incorporated into any 
contract.</p>
</div></div></div></div>
</div>
<!-- END PC1 COMPONENT V.2 -->
<!-- BEGIN G9 VARIATION 0 -->
<script language="javascript" type="text/javascript" charset="UTF-8" src="emailcontents_files/oo_engine.js"></script>
<script language="javascript" type="text/javascript" charset="UTF-8" src="emailcontents_files/oo_conf_en-US.js"></script>
<!-- END G9 VARIATION 0 -->
<!-- BEGIN VNV5 FOOTER  -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tbody><tr>
<td>
<table class="vatop" border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="4" class="grey3" valign="top"><img src="emailcontents_files/a_002.gif" alt="" border="0" height="2" width="1"></td></tr>
<tr>
<td><img src="emailcontents_files/a.gif" alt="" border="0" height="1" width="190"><br>
<a href="http://www.oracle.com/index.html"><img src="emailcontents_files/logo_oracle_footer.gif" alt="" border="0" height="29" vspace="5" width="93"></a></td>
<td valign="top" width="100%"><img src="emailcontents_files/a_002.gif" alt="" border="0" height="1" width="350"><br>
<div class="footer">
<a href="http://developers.sun.com/global/aboutsun.html">About Sun</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/aboutsdn.html">About This Site</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/newsletters.html">Newsletters</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/contact.html">Contact Us</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/employment.html">Employment</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/howtobuy.html">How to Buy</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/licensing.html">Licensing</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/termsofuse.html">Terms of Use</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/privacy.html">Privacy</a> &nbsp;|&nbsp;
<a href="http://developers.sun.com/global/trademarks.html">Trademarks</a>
<br><span class="sp10">&nbsp;</span><br>
<br><span class="sp10">&nbsp;</span><br>
<!-- <span id="copyDate" class="cssDate"></span>--> © 2010, Oracle Corporation and/or its affiliates
</div></td>
<td><img src="emailcontents_files/a_002.gif" alt="" border="0" height="1" width="40"></td>
<td valign="top"><div class="footer"><b><a href="http://developers.sun.com/global/aboutsdn.html">A Sun Developer Network Site</a></b></div>
<div class="footer">
<img src="emailcontents_files/a_002.gif" alt="" border="0" height="1" width="170"><br>
Unless otherwise licensed, code in all technical manuals herein (including articles, FAQs, samples) is provided under this <a href="http://developers.sun.com/global/berkeley_license.html">License</a>.
<br><span class="sp5">&nbsp;</span><br>
<a href="http://developers.sun.com/global/rss_sdn.html"><img src="emailcontents_files/ic_feed_16x.gif" alt="XML" align="top" border="0" height="16" width="16"></a>&nbsp;<a href="http://developers.sun.com/global/content_feeds.html">Sun Developer RSS Feeds</a>
</div></td></tr>
<tr><td colspan="4" class="grey3" valign="top"><img src="emailcontents_files/a_002.gif" alt="" border="0" height="2" width="1"></td></tr>
</tbody></table>
</td></tr>
</tbody></table>
<!-- END VNV5 FOOTER -->
<script language="JavaScript" src="emailcontents_files/s_code_remote.js"></script><script language="JavaScript" src="emailcontents_files/metrics_group1.js"></script>




</body></html>